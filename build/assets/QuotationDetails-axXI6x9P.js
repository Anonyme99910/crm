import{a as $,n as h,c as o,d as u,b as t,t as a,i as D,x as N,k as _,l as B,s as r,F,p as Q,j as V,q as c,h as Y,f as E,o as l}from"./app-Cs6lHxPq.js";import{d as M}from"./dayjs.min-CxMP4GVf.js";const P={key:0,class:"space-y-6"},G={class:"flex items-center justify-between"},L={class:"text-2xl font-bold"},R={class:"text-gray-500"},S={class:"flex items-center gap-3"},z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},I={class:"lg:col-span-2"},T={class:"card"},A={class:"card-body"},H={class:"grid grid-cols-2 gap-4 text-sm mb-6"},J={class:"mr-2 font-medium"},K={class:"mr-2",dir:"ltr"},O={class:"mr-2"},U={class:"mr-2"},W={class:"table"},X={class:"flex justify-end mt-6"},Z={class:"w-64 space-y-2 text-sm"},tt={class:"flex justify-between"},st={key:0,class:"flex justify-between text-red-600"},et={key:1,class:"flex justify-between"},at={class:"flex justify-between font-bold text-lg border-t pt-2"},nt={key:0,class:"mt-6 p-4 bg-gray-50 rounded-lg"},lt={class:"text-sm text-gray-600 whitespace-pre-line"},ot={class:"space-y-6"},dt={class:"card"},it={class:"card-body space-y-3"},ut={class:"card"},rt={class:"card-body space-y-2 text-sm"},ct={class:"flex justify-between"},pt={class:"flex justify-between"},vt={class:"text-green-600 font-medium"},mt={__name:"QuotationDetails",setup(bt){const g=Y(),x=E(),e=$(null),p=async()=>{const{data:n}=await c.get(`/quotations/${g.params.id}`);e.value=n.data},w=async()=>{await c.post(`/quotations/${e.value.id}/send`),p()},v=async n=>{await c.put(`/quotations/${e.value.id}`,{status:n}),p()},k=async()=>{const{data:n}=await c.post(`/quotations/${e.value.id}/pdf`);window.open(n.data.pdf_url,"_blank")},j=async()=>{const{data:n}=await c.post(`/quotations/${e.value.id}/duplicate`);x.push(`/quotations/${n.data.id}/edit`)},b=n=>M(n).format("YYYY/MM/DD"),d=n=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(n||0),q=n=>({draft:"مسودة",sent:"مرسل",viewed:"تم العرض",accepted:"مقبول",rejected:"مرفوض"})[n]||n,C=n=>({draft:"badge-gray",sent:"badge-info",viewed:"badge-warning",accepted:"badge-success",rejected:"badge-danger"})[n]||"badge-gray";return h(p),(n,s)=>{var f,m;const y=B("router-link");return e.value?(l(),o("div",P,[t("div",G,[t("div",null,[t("h2",L,a(e.value.quotation_number),1),t("p",R,a(e.value.title),1)]),t("div",S,[t("span",{class:N([C(e.value.status),"badge text-base px-4 py-2"])},a(q(e.value.status)),3),D(y,{to:`/quotations/${e.value.id}/edit`,class:"btn btn-secondary"},{default:_(()=>[...s[2]||(s[2]=[r("تعديل",-1)])]),_:1},8,["to"]),t("button",{onClick:k,class:"btn btn-primary"},"تحميل PDF")])]),t("div",z,[t("div",I,[t("div",T,[s[17]||(s[17]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold"},"تفاصيل العرض")],-1)),t("div",A,[t("div",H,[t("div",null,[s[3]||(s[3]=t("span",{class:"text-gray-500"},"العميل:",-1)),s[4]||(s[4]=r()),t("span",J,a((f=e.value.lead)==null?void 0:f.name),1)]),t("div",null,[s[5]||(s[5]=t("span",{class:"text-gray-500"},"الهاتف:",-1)),s[6]||(s[6]=r()),t("span",K,a((m=e.value.lead)==null?void 0:m.phone),1)]),t("div",null,[s[7]||(s[7]=t("span",{class:"text-gray-500"},"تاريخ الإنشاء:",-1)),s[8]||(s[8]=r()),t("span",O,a(b(e.value.created_at)),1)]),t("div",null,[s[9]||(s[9]=t("span",{class:"text-gray-500"},"صالح حتى:",-1)),s[10]||(s[10]=r()),t("span",U,a(b(e.value.valid_until)),1)])]),t("table",W,[s[11]||(s[11]=t("thead",null,[t("tr",null,[t("th",null,"البند"),t("th",null,"الوحدة"),t("th",null,"الكمية"),t("th",null,"سعر الوحدة"),t("th",null,"الإجمالي")])],-1)),t("tbody",null,[(l(!0),o(F,null,Q(e.value.items,i=>(l(),o("tr",{key:i.id},[t("td",null,a(i.name),1),t("td",null,a(i.unit),1),t("td",null,a(i.quantity),1),t("td",null,a(d(i.unit_price)),1),t("td",null,a(d(i.total)),1)]))),128))])]),t("div",X,[t("div",Z,[t("div",tt,[s[12]||(s[12]=t("span",null,"الإجمالي الفرعي:",-1)),t("span",null,a(d(e.value.subtotal)),1)]),e.value.discount_amount>0?(l(),o("div",st,[s[13]||(s[13]=t("span",null,"الخصم:",-1)),t("span",null,"-"+a(d(e.value.discount_amount)),1)])):u("",!0),e.value.tax_amount>0?(l(),o("div",et,[s[14]||(s[14]=t("span",null,"الضريبة:",-1)),t("span",null,a(d(e.value.tax_amount)),1)])):u("",!0),t("div",at,[s[15]||(s[15]=t("span",null,"الإجمالي:",-1)),t("span",null,a(d(e.value.total)),1)])])]),e.value.terms_conditions?(l(),o("div",nt,[s[16]||(s[16]=t("h4",{class:"font-semibold mb-2"},"الشروط والأحكام",-1)),t("p",lt,a(e.value.terms_conditions),1)])):u("",!0)])])]),t("div",ot,[t("div",dt,[s[19]||(s[19]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold"},"إجراءات")],-1)),t("div",it,[e.value.status==="draft"?(l(),o("button",{key:0,onClick:w,class:"btn btn-primary w-full"},"إرسال للعميل")):u("",!0),e.value.status==="sent"||e.value.status==="viewed"?(l(),o("button",{key:1,onClick:s[0]||(s[0]=i=>v("accepted")),class:"btn btn-success w-full"},"تحديد كمقبول")):u("",!0),e.value.status==="sent"||e.value.status==="viewed"?(l(),o("button",{key:2,onClick:s[1]||(s[1]=i=>v("rejected")),class:"btn btn-danger w-full"},"تحديد كمرفوض")):u("",!0),t("button",{onClick:j,class:"btn btn-secondary w-full"},"نسخ العرض"),e.value.status==="accepted"?(l(),V(y,{key:3,to:`/projects/create?quotation_id=${e.value.id}&lead_id=${e.value.lead_id}`,class:"btn btn-primary w-full block text-center"},{default:_(()=>[...s[18]||(s[18]=[r("إنشاء مشروع",-1)])]),_:1},8,["to"])):u("",!0)])]),t("div",ut,[s[22]||(s[22]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold"},"معلومات الربح")],-1)),t("div",rt,[t("div",ct,[s[20]||(s[20]=t("span",{class:"text-gray-500"},"التكلفة:",-1)),t("span",null,a(d(e.value.cost_price)),1)]),t("div",pt,[s[21]||(s[21]=t("span",{class:"text-gray-500"},"هامش الربح:",-1)),t("span",vt,a(d(e.value.profit_margin)),1)])])])])])])):u("",!0)}}};export{mt as default};
