import{a as $,r as A,n as G,c as i,d as D,b as s,t as l,i as V,k as m,l as H,s as d,x as I,F as y,p as b,e as c,y as f,z as j,w as P,v as R,q as g,h as J,o as n,j as Y}from"./app-PrQ92K9m.js";import{d as h}from"./dayjs.min-CxMP4GVf.js";const K={key:0,class:"space-y-6"},O={class:"flex items-center justify-between"},Q={class:"text-2xl font-bold text-gray-900"},W={class:"text-gray-500"},X={class:"flex items-center gap-3"},Z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ss={class:"lg:col-span-2 space-y-6"},ts={class:"card"},es={class:"card-body grid grid-cols-2 gap-4 text-sm"},os={class:"mr-2"},as={class:"mr-2",dir:"ltr"},ls={class:"mr-2"},ns={class:"badge badge-gray mr-2"},is={class:"mr-2"},ds={class:"mr-2"},rs={class:"mr-2"},us={class:"col-span-2"},ps={class:"mr-2"},vs={class:"col-span-2"},ms={class:"mr-2"},cs={class:"card"},gs={class:"card-header flex items-center justify-between"},ys={class:"card-body"},bs={key:0,class:"text-center text-gray-500 py-8"},fs={key:1,class:"space-y-4"},xs={class:"flex-1"},_s={class:"text-sm text-gray-900"},ws={class:"text-xs text-gray-500 mt-1"},ks={class:"space-y-6"},Ms={class:"card"},Cs={class:"card-body space-y-3"},$s={class:"card"},Ds={class:"card-body"},Vs={key:0,class:"text-center text-gray-500 py-4"},js={key:1,class:"space-y-2"},Ys={class:"text-sm font-medium"},hs={class:"text-xs text-gray-500"},Ls={class:"card"},Ns={class:"card-body"},Ss={key:0,class:"text-center text-gray-500 py-4"},qs={key:1,class:"space-y-2"},Bs={class:"text-sm font-medium"},zs={class:"text-xs text-gray-500"},Fs={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Us={class:"bg-white rounded-xl p-6 w-full max-w-md"},Es={class:"flex gap-3"},Hs={__name:"LeadDetails",setup(Ts){const L=J(),e=$(null),p=$(!1),r=A({type:"note",description:""}),x=async()=>{const{data:a}=await g.get(`/leads/${L.params.id}`);e.value=a.data},N=async()=>{await g.put(`/leads/${e.value.id}`,{status:e.value.status})},S=async()=>{await g.put(`/leads/${e.value.id}`,{stage:e.value.stage})},q=async()=>{await g.post(`/leads/${e.value.id}/activities`,r),p.value=!1,r.description="",x()},B=a=>h(a).format("YYYY/MM/DD"),z=a=>h(a).format("YYYY/MM/DD HH:mm"),_=a=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(a),F=a=>({whatsapp:"واتساب",ads:"إعلانات",call:"مكالمات",website:"موقع",referral:"إحالة",other:"أخرى"})[a]||a,U=a=>({hot:"ساخن",warm:"دافئ",cold:"بارد"})[a]||a,E=a=>({hot:"badge-danger",warm:"badge-warning",cold:"badge-info"})[a]||"badge-gray",T=a=>({new:"جديد",contacted:"تم التواصل",qualified:"مؤهل",proposal:"عرض سعر",negotiation:"تفاوض",won:"مكسب",lost:"خسارة"})[a]||a;return G(x),(a,t)=>{var w,k,M,C;const v=H("router-link");return e.value?(n(),i("div",K,[s("div",O,[s("div",null,[s("h2",Q,l(e.value.name),1),s("p",W,l(e.value.phone),1)]),s("div",X,[V(v,{to:`/leads/${e.value.id}/edit`,class:"btn btn-secondary"},{default:m(()=>[...t[6]||(t[6]=[d("تعديل",-1)])]),_:1},8,["to"]),V(v,{to:`/site-visits/create?lead_id=${e.value.id}`,class:"btn btn-primary"},{default:m(()=>[...t[7]||(t[7]=[d("جدولة معاينة",-1)])]),_:1},8,["to"])])]),s("div",Z,[s("div",ss,[s("div",ts,[t[28]||(t[28]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"بيانات العميل")],-1)),s("div",es,[s("div",null,[t[8]||(t[8]=s("span",{class:"text-gray-500"},"البريد:",-1)),t[9]||(t[9]=d()),s("span",os,l(e.value.email||"-"),1)]),s("div",null,[t[10]||(t[10]=s("span",{class:"text-gray-500"},"واتساب:",-1)),t[11]||(t[11]=d()),s("span",as,l(e.value.whatsapp||"-"),1)]),s("div",null,[t[12]||(t[12]=s("span",{class:"text-gray-500"},"المصدر:",-1)),t[13]||(t[13]=d()),s("span",ls,l(F(e.value.source)),1)]),s("div",null,[t[14]||(t[14]=s("span",{class:"text-gray-500"},"الحالة:",-1)),t[15]||(t[15]=d()),s("span",{class:I([E(e.value.status),"badge mr-2"])},l(U(e.value.status)),3)]),s("div",null,[t[16]||(t[16]=s("span",{class:"text-gray-500"},"المرحلة:",-1)),t[17]||(t[17]=d()),s("span",ns,l(T(e.value.stage)),1)]),s("div",null,[t[18]||(t[18]=s("span",{class:"text-gray-500"},"نوع المشروع:",-1)),t[19]||(t[19]=d()),s("span",is,l(e.value.project_type||"-"),1)]),s("div",null,[t[20]||(t[20]=s("span",{class:"text-gray-500"},"الميزانية:",-1)),t[21]||(t[21]=d()),s("span",ds,l(e.value.estimated_budget?_(e.value.estimated_budget):"-"),1)]),s("div",null,[t[22]||(t[22]=s("span",{class:"text-gray-500"},"المسؤول:",-1)),t[23]||(t[23]=d()),s("span",rs,l(((w=e.value.assigned_user)==null?void 0:w.name)||"-"),1)]),s("div",us,[t[24]||(t[24]=s("span",{class:"text-gray-500"},"العنوان:",-1)),t[25]||(t[25]=d()),s("span",ps,l(e.value.address||"-"),1)]),s("div",vs,[t[26]||(t[26]=s("span",{class:"text-gray-500"},"ملاحظات:",-1)),t[27]||(t[27]=d()),s("span",ms,l(e.value.notes||"-"),1)])])]),s("div",cs,[s("div",gs,[t[29]||(t[29]=s("h3",{class:"font-semibold"},"سجل النشاطات",-1)),s("button",{onClick:t[0]||(t[0]=o=>p.value=!0),class:"btn btn-sm btn-primary"},"إضافة نشاط")]),s("div",ys,[((k=e.value.activities)==null?void 0:k.length)===0?(n(),i("div",bs,"لا توجد نشاطات")):(n(),i("div",fs,[(n(!0),i(y,null,b(e.value.activities,o=>{var u;return n(),i("div",{key:o.id,class:"flex gap-4 p-3 bg-gray-50 rounded-lg"},[t[30]||(t[30]=s("div",{class:"w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center"},[s("svg",{class:"w-5 h-5 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})])],-1)),s("div",xs,[s("p",_s,l(o.description),1),s("p",ws,l((u=o.user)==null?void 0:u.name)+" - "+l(z(o.created_at)),1)])])}),128))]))])])]),s("div",ks,[s("div",Ms,[t[33]||(t[33]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"تغيير الحالة")],-1)),s("div",Cs,[c(s("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>e.value.status=o),onChange:N,class:"form-input"},[...t[31]||(t[31]=[s("option",{value:"cold"},"بارد",-1),s("option",{value:"warm"},"دافئ",-1),s("option",{value:"hot"},"ساخن",-1)])],544),[[f,e.value.status]]),c(s("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>e.value.stage=o),onChange:S,class:"form-input"},[...t[32]||(t[32]=[j('<option value="new">جديد</option><option value="contacted">تم التواصل</option><option value="qualified">مؤهل</option><option value="proposal">عرض سعر</option><option value="negotiation">تفاوض</option><option value="won">مكسب</option><option value="lost">خسارة</option>',7)])],544),[[f,e.value.stage]])])]),s("div",$s,[t[34]||(t[34]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"المعاينات")],-1)),s("div",Ds,[((M=e.value.site_visits)==null?void 0:M.length)===0?(n(),i("div",Vs,"لا توجد معاينات")):(n(),i("div",js,[(n(!0),i(y,null,b(e.value.site_visits,o=>(n(),Y(v,{key:o.id,to:`/site-visits/${o.id}`,class:"block p-3 bg-gray-50 rounded-lg hover:bg-gray-100"},{default:m(()=>{var u;return[s("p",Ys,l(B(o.scheduled_at)),1),s("p",hs,"م. "+l((u=o.engineer)==null?void 0:u.name),1)]}),_:2},1032,["to"]))),128))]))])]),s("div",Ls,[t[35]||(t[35]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"عروض الأسعار")],-1)),s("div",Ns,[((C=e.value.quotations)==null?void 0:C.length)===0?(n(),i("div",Ss,"لا توجد عروض")):(n(),i("div",qs,[(n(!0),i(y,null,b(e.value.quotations,o=>(n(),Y(v,{key:o.id,to:`/quotations/${o.id}`,class:"block p-3 bg-gray-50 rounded-lg hover:bg-gray-100"},{default:m(()=>[s("p",Bs,l(o.quotation_number),1),s("p",zs,l(_(o.total)),1)]),_:2},1032,["to"]))),128))]))])])])]),p.value?(n(),i("div",Fs,[s("div",Us,[t[40]||(t[40]=s("h3",{class:"text-lg font-semibold mb-4"},"إضافة نشاط",-1)),s("form",{onSubmit:P(q,["prevent"]),class:"space-y-4"},[s("div",null,[t[37]||(t[37]=s("label",{class:"form-label"},"النوع",-1)),c(s("select",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.type=o),class:"form-input"},[...t[36]||(t[36]=[j('<option value="call">مكالمة</option><option value="whatsapp">واتساب</option><option value="email">بريد</option><option value="meeting">اجتماع</option><option value="note">ملاحظة</option>',5)])],512),[[f,r.type]])]),s("div",null,[t[38]||(t[38]=s("label",{class:"form-label"},"الوصف",-1)),c(s("textarea",{"onUpdate:modelValue":t[4]||(t[4]=o=>r.description=o),class:"form-input",rows:"3",required:""},null,512),[[R,r.description]])]),s("div",Es,[t[39]||(t[39]=s("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),s("button",{type:"button",onClick:t[5]||(t[5]=o=>p.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):D("",!0)])):D("",!0)}}};export{Hs as default};
