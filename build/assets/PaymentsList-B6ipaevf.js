import{a as d,r as _,n as U,c as a,b as t,d as q,F as p,p as v,w as C,e as i,y as f,v as b,q as m,o as r,t as o}from"./app-Cs6lHxPq.js";import{d as M}from"./dayjs.min-CxMP4GVf.js";const P={class:"space-y-6"},B={class:"flex items-center justify-between"},E={class:"card"},F={class:"table-container"},L={class:"table"},N={class:"font-medium"},R={class:"text-green-600 font-medium"},S={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},G={class:"bg-white rounded-xl p-6 w-full max-w-md"},$=["value"],z=["value"],I={class:"flex gap-3"},J={__name:"PaymentsList",setup(T){const y=d([]),c=d([]),x=d([]),u=d(!1),n=_({project_id:null,invoice_id:null,amount:0,method:"cash",payment_date:M().format("YYYY-MM-DD"),reference:""}),k=async()=>{const[s,e,l]=await Promise.all([m.get("/payments"),m.get("/projects"),m.get("/invoices",{params:{status:"sent"}})]);y.value=s.data.data,c.value=e.data.data,x.value=l.data.data},D=async()=>{await m.post("/payments",n),u.value=!1,k()},V=s=>M(s).format("YYYY/MM/DD"),w=s=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(s),Y=s=>({cash:"نقدي",bank_transfer:"تحويل بنكي",check:"شيك",credit_card:"بطاقة ائتمان"})[s]||s;return U(k),(s,e)=>(r(),a("div",P,[t("div",B,[e[8]||(e[8]=t("h2",{class:"text-xl font-bold"},"المدفوعات",-1)),t("button",{onClick:e[0]||(e[0]=l=>u.value=!0),class:"btn btn-primary"},"تسجيل دفعة")]),t("div",E,[t("div",F,[t("table",L,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"رقم الدفعة"),t("th",null,"المشروع"),t("th",null,"الفاتورة"),t("th",null,"المبلغ"),t("th",null,"الطريقة"),t("th",null,"التاريخ")])],-1)),t("tbody",null,[(r(!0),a(p,null,v(y.value,l=>{var g,j;return r(),a("tr",{key:l.id},[t("td",N,o(l.payment_number),1),t("td",null,o((g=l.project)==null?void 0:g.name),1),t("td",null,o(((j=l.invoice)==null?void 0:j.invoice_number)||"-"),1),t("td",R,o(w(l.amount)),1),t("td",null,o(Y(l.method)),1),t("td",null,o(V(l.payment_date)),1)])}),128))])])])]),u.value?(r(),a("div",S,[t("div",G,[e[20]||(e[20]=t("h3",{class:"text-lg font-semibold mb-4"},"تسجيل دفعة",-1)),t("form",{onSubmit:C(D,["prevent"]),class:"space-y-4"},[t("div",null,[e[11]||(e[11]=t("label",{class:"form-label"},"المشروع *",-1)),i(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>n.project_id=l),class:"form-input",required:""},[e[10]||(e[10]=t("option",{value:null},"-- اختر --",-1)),(r(!0),a(p,null,v(c.value,l=>(r(),a("option",{key:l.id,value:l.id},o(l.name),9,$))),128))],512),[[f,n.project_id]])]),t("div",null,[e[13]||(e[13]=t("label",{class:"form-label"},"الفاتورة",-1)),i(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>n.invoice_id=l),class:"form-input"},[e[12]||(e[12]=t("option",{value:null},"-- اختر --",-1)),(r(!0),a(p,null,v(x.value,l=>(r(),a("option",{key:l.id,value:l.id},o(l.invoice_number)+" - "+o(w(l.total-l.paid_amount)),9,z))),128))],512),[[f,n.invoice_id]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"form-label"},"المبلغ *",-1)),i(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>n.amount=l),type:"number",class:"form-input",min:"0",required:""},null,512),[[b,n.amount]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"form-label"},"طريقة الدفع *",-1)),i(t("select",{"onUpdate:modelValue":e[4]||(e[4]=l=>n.method=l),class:"form-input",required:""},[...e[15]||(e[15]=[t("option",{value:"cash"},"نقدي",-1),t("option",{value:"bank_transfer"},"تحويل بنكي",-1),t("option",{value:"check"},"شيك",-1),t("option",{value:"credit_card"},"بطاقة ائتمان",-1)])],512),[[f,n.method]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"form-label"},"التاريخ *",-1)),i(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>n.payment_date=l),type:"date",class:"form-input",required:""},null,512),[[b,n.payment_date]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"form-label"},"المرجع",-1)),i(t("input",{"onUpdate:modelValue":e[6]||(e[6]=l=>n.reference=l),class:"form-input"},null,512),[[b,n.reference]])]),t("div",I,[e[19]||(e[19]=t("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),t("button",{type:"button",onClick:e[7]||(e[7]=l=>u.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):q("",!0)]))}};export{J as default};
