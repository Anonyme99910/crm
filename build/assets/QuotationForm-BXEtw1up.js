import{g as v,h as B,a as w,r as E,n as F,c as u,b as t,t as d,w as N,e as n,y as S,F as V,p as k,v as o,i as Y,k as $,l as A,q as b,f as G,o as p,s as L}from"./app-Cs6lHxPq.js";import{d as R}from"./dayjs.min-CxMP4GVf.js";const T={class:"space-y-6"},h={class:"card"},H={class:"card-header"},O={class:"font-semibold"},P={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Q=["value"],z={class:"space-y-4"},J={class:"col-span-4"},K=["onUpdate:modelValue"],W={class:"col-span-2"},X=["onUpdate:modelValue"],Z={class:"col-span-2"},tt=["onUpdate:modelValue"],st={class:"col-span-2"},et=["onUpdate:modelValue"],lt={class:"col-span-1 text-center font-medium"},at={class:"col-span-1"},nt=["onClick"],ot={class:"flex justify-end"},it={class:"w-64 space-y-2 text-sm"},dt={class:"flex justify-between"},rt={class:"flex justify-between"},ut={class:"flex justify-between font-bold text-lg border-t pt-2"},pt={class:"flex gap-4"},mt=["disabled"],ft={__name:"QuotationForm",setup(ct){const r=B(),U=G(),f=v(()=>!!r.params.id),m=w(!1),x=w([]),l=E({lead_id:r.query.lead_id?parseInt(r.query.lead_id):null,site_visit_id:r.query.site_visit_id?parseInt(r.query.site_visit_id):null,title:"",description:"",tax_rate:14,valid_until:R().add(30,"day").format("YYYY-MM-DD"),terms_conditions:"",items:[{name:"",unit:"وحدة",quantity:1,unit_price:0}]}),y=v(()=>l.items.reduce((a,s)=>a+s.quantity*s.unit_price,0)),g=v(()=>y.value*(l.tax_rate/100)),j=v(()=>y.value+g.value),M=()=>l.items.push({name:"",unit:"وحدة",quantity:1,unit_price:0}),C=a=>l.items.length>1&&l.items.splice(a,1),c=a=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(a||0),D=async()=>{const{data:a}=await b.get("/leads",{params:{per_page:100}});if(x.value=a.data,f.value){const s=await b.get(`/quotations/${r.params.id}`);Object.assign(l,s.data.data)}},I=async()=>{var a,s;m.value=!0;try{f.value?await b.put(`/quotations/${r.params.id}`,l):await b.post("/quotations",l),U.push("/quotations")}catch(_){alert(((s=(a=_.response)==null?void 0:a.data)==null?void 0:s.message)||"حدث خطأ")}finally{m.value=!1}};return F(D),(a,s)=>{const _=A("router-link");return p(),u("div",T,[t("div",h,[t("div",H,[t("h3",O,d(f.value?"تعديل عرض السعر":"إنشاء عرض سعر جديد"),1)]),t("form",{onSubmit:N(I,["prevent"]),class:"card-body space-y-6"},[t("div",P,[t("div",null,[s[7]||(s[7]=t("label",{class:"form-label"},"العميل *",-1)),n(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>l.lead_id=e),class:"form-input",required:""},[s[6]||(s[6]=t("option",{value:null},"-- اختر --",-1)),(p(!0),u(V,null,k(x.value,e=>(p(),u("option",{key:e.id,value:e.id},d(e.name),9,Q))),128))],512),[[S,l.lead_id]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"form-label"},"العنوان *",-1)),n(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>l.title=e),type:"text",class:"form-input",required:""},null,512),[[o,l.title]])]),t("div",null,[s[9]||(s[9]=t("label",{class:"form-label"},"صالح حتى *",-1)),n(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>l.valid_until=e),type:"date",class:"form-input",required:""},null,512),[[o,l.valid_until]])]),t("div",null,[s[10]||(s[10]=t("label",{class:"form-label"},"نسبة الضريبة %",-1)),n(t("input",{"onUpdate:modelValue":s[3]||(s[3]=e=>l.tax_rate=e),type:"number",class:"form-input",min:"0",max:"100"},null,512),[[o,l.tax_rate]])])]),t("div",null,[s[11]||(s[11]=t("label",{class:"form-label"},"الوصف",-1)),n(t("textarea",{"onUpdate:modelValue":s[4]||(s[4]=e=>l.description=e),class:"form-input",rows:"2"},null,512),[[o,l.description]])]),t("div",null,[t("div",{class:"flex items-center justify-between mb-4"},[s[12]||(s[12]=t("h4",{class:"font-semibold"},"البنود",-1)),t("button",{type:"button",onClick:M,class:"btn btn-sm btn-secondary"},"إضافة بند")]),t("div",z,[(p(!0),u(V,null,k(l.items,(e,q)=>(p(),u("div",{key:q,class:"grid grid-cols-12 gap-3 items-end p-4 bg-gray-50 rounded-lg"},[t("div",J,[s[13]||(s[13]=t("label",{class:"form-label text-xs"},"البند",-1)),n(t("input",{"onUpdate:modelValue":i=>e.name=i,type:"text",class:"form-input",required:""},null,8,K),[[o,e.name]])]),t("div",W,[s[14]||(s[14]=t("label",{class:"form-label text-xs"},"الوحدة",-1)),n(t("input",{"onUpdate:modelValue":i=>e.unit=i,type:"text",class:"form-input"},null,8,X),[[o,e.unit]])]),t("div",Z,[s[15]||(s[15]=t("label",{class:"form-label text-xs"},"الكمية",-1)),n(t("input",{"onUpdate:modelValue":i=>e.quantity=i,type:"number",class:"form-input",min:"0",step:"0.01",required:""},null,8,tt),[[o,e.quantity]])]),t("div",st,[s[16]||(s[16]=t("label",{class:"form-label text-xs"},"سعر الوحدة",-1)),n(t("input",{"onUpdate:modelValue":i=>e.unit_price=i,type:"number",class:"form-input",min:"0",step:"0.01",required:""},null,8,et),[[o,e.unit_price]])]),t("div",lt,d(c(e.quantity*e.unit_price)),1),t("div",at,[t("button",{type:"button",onClick:i=>C(q),class:"text-red-600 hover:text-red-800"},[...s[17]||(s[17]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,nt)])]))),128))])]),t("div",ot,[t("div",it,[t("div",dt,[s[18]||(s[18]=t("span",null,"الإجمالي الفرعي:",-1)),t("span",null,d(c(y.value)),1)]),t("div",rt,[t("span",null,"الضريبة ("+d(l.tax_rate)+"%):",1),t("span",null,d(c(g.value)),1)]),t("div",ut,[s[19]||(s[19]=t("span",null,"الإجمالي:",-1)),t("span",null,d(c(j.value)),1)])])]),t("div",null,[s[20]||(s[20]=t("label",{class:"form-label"},"الشروط والأحكام",-1)),n(t("textarea",{"onUpdate:modelValue":s[5]||(s[5]=e=>l.terms_conditions=e),class:"form-input",rows:"3"},null,512),[[o,l.terms_conditions]])]),t("div",pt,[t("button",{type:"submit",disabled:m.value,class:"btn btn-primary"},d(m.value?"جاري الحفظ...":"حفظ"),9,mt),Y(_,{to:"/quotations",class:"btn btn-secondary"},{default:$(()=>[...s[21]||(s[21]=[L("إلغاء",-1)])]),_:1})])],32)])])}}};export{ft as default};
