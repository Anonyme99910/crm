import{a as d,r as M,n as D,c as a,b as t,d as R,F as p,p as c,w as Y,e as m,y as f,q as b,o as n,t as i,x as B,v as w}from"./app-Cs6lHxPq.js";import{d as E}from"./dayjs.min-CxMP4GVf.js";const F={class:"space-y-6"},L={class:"flex items-center justify-between"},N={class:"card"},P={class:"table-container"},S={class:"table"},$={class:"font-medium"},z={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 overflow-y-auto py-8"},G={class:"bg-white rounded-xl p-6 w-full max-w-2xl"},I={class:"grid grid-cols-2 gap-4"},O=["value"],T=["value"],A=["onUpdate:modelValue"],H=["value"],J=["onUpdate:modelValue"],K=["onUpdate:modelValue"],Q=["onClick"],W={class:"flex gap-3"},et={__name:"PurchaseOrdersList",setup(X){const y=d([]),_=d([]),g=d([]),x=d([]),v=d(!1),r=M({supplier_id:null,project_id:null,items:[{material_id:null,quantity:1,unit_price:0}]}),k=async()=>{const[o,l,e,u]=await Promise.all([b.get("/purchase-orders"),b.get("/suppliers"),b.get("/projects"),b.get("/materials")]);y.value=o.data.data,_.value=l.data.data,g.value=e.data.data,x.value=u.data.data},j=()=>r.items.push({material_id:null,quantity:1,unit_price:0}),h=async()=>{await b.post("/purchase-orders",r),v.value=!1,r.items=[{material_id:null,quantity:1,unit_price:0}],k()},C=o=>E(o).format("YYYY/MM/DD"),V=o=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(o),U=o=>({draft:"مسودة",pending_approval:"بانتظار الموافقة",approved:"موافق عليه",sent:"مرسل",received:"مستلم",cancelled:"ملغي"})[o]||o,q=o=>({draft:"badge-gray",approved:"badge-info",sent:"badge-warning",received:"badge-success",cancelled:"badge-danger"})[o]||"badge-gray";return D(k),(o,l)=>(n(),a("div",F,[t("div",L,[l[4]||(l[4]=t("h2",{class:"text-xl font-bold"},"أوامر الشراء",-1)),t("button",{onClick:l[0]||(l[0]=e=>v.value=!0),class:"btn btn-primary"},"إنشاء أمر شراء")]),t("div",N,[t("div",P,[t("table",S,[l[5]||(l[5]=t("thead",null,[t("tr",null,[t("th",null,"رقم الأمر"),t("th",null,"المورد"),t("th",null,"المشروع"),t("th",null,"الإجمالي"),t("th",null,"الحالة"),t("th",null,"التاريخ")])],-1)),t("tbody",null,[(n(!0),a(p,null,c(y.value,e=>{var u,s;return n(),a("tr",{key:e.id},[t("td",$,i(e.po_number),1),t("td",null,i((u=e.supplier)==null?void 0:u.name),1),t("td",null,i(((s=e.project)==null?void 0:s.name)||"-"),1),t("td",null,i(V(e.total)),1),t("td",null,[t("span",{class:B([q(e.status),"badge"])},i(U(e.status)),3)]),t("td",null,i(C(e.created_at)),1)])}),128))])])])]),v.value?(n(),a("div",z,[t("div",G,[l[13]||(l[13]=t("h3",{class:"text-lg font-semibold mb-4"},"إنشاء أمر شراء",-1)),t("form",{onSubmit:Y(h,["prevent"]),class:"space-y-4"},[t("div",I,[t("div",null,[l[7]||(l[7]=t("label",{class:"form-label"},"المورد *",-1)),m(t("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>r.supplier_id=e),class:"form-input",required:""},[l[6]||(l[6]=t("option",{value:null},"-- اختر --",-1)),(n(!0),a(p,null,c(_.value,e=>(n(),a("option",{key:e.id,value:e.id},i(e.name),9,O))),128))],512),[[f,r.supplier_id]])]),t("div",null,[l[9]||(l[9]=t("label",{class:"form-label"},"المشروع",-1)),m(t("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>r.project_id=e),class:"form-input"},[l[8]||(l[8]=t("option",{value:null},"-- اختر --",-1)),(n(!0),a(p,null,c(g.value,e=>(n(),a("option",{key:e.id,value:e.id},i(e.name),9,T))),128))],512),[[f,r.project_id]])])]),t("div",null,[t("div",{class:"flex items-center justify-between mb-2"},[l[10]||(l[10]=t("label",{class:"form-label"},"البنود",-1)),t("button",{type:"button",onClick:j,class:"text-sm text-primary-600"},"+ إضافة")]),(n(!0),a(p,null,c(r.items,(e,u)=>(n(),a("div",{key:u,class:"grid grid-cols-12 gap-2 mb-2"},[m(t("select",{"onUpdate:modelValue":s=>e.material_id=s,class:"form-input col-span-5"},[l[11]||(l[11]=t("option",{value:null},"-- الخامة --",-1)),(n(!0),a(p,null,c(x.value,s=>(n(),a("option",{key:s.id,value:s.id},i(s.name),9,H))),128))],8,A),[[f,e.material_id]]),m(t("input",{"onUpdate:modelValue":s=>e.quantity=s,type:"number",class:"form-input col-span-3",placeholder:"الكمية",min:"1"},null,8,J),[[w,e.quantity]]),m(t("input",{"onUpdate:modelValue":s=>e.unit_price=s,type:"number",class:"form-input col-span-3",placeholder:"السعر",min:"0"},null,8,K),[[w,e.unit_price]]),t("button",{type:"button",onClick:s=>r.items.splice(u,1),class:"text-red-600 col-span-1"},"×",8,Q)]))),128))]),t("div",W,[l[12]||(l[12]=t("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),t("button",{type:"button",onClick:l[3]||(l[3]=e=>v.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):R("",!0)]))}};export{et as default};
