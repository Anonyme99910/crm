import{a as V,r as S,n as T,c as a,d as r,b as s,t as n,x as D,s as u,F as M,p as j,i as Y,k as B,l as z,w as H,e as m,v as p,q as b,h as L,o}from"./app-PrQ92K9m.js";import{d as E}from"./dayjs.min-CxMP4GVf.js";const O={key:0,class:"space-y-6"},P={class:"flex items-center justify-between"},R={class:"text-2xl font-bold"},A={class:"text-gray-500"},G={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},I={class:"lg:col-span-2 space-y-6"},J={class:"card"},K={class:"card-body space-y-4"},Q={class:"grid grid-cols-2 gap-4 text-sm"},W={class:"mr-2 font-medium"},X={class:"mr-2",dir:"ltr"},Z={class:"mr-2"},ss={class:"mt-1"},ts={key:0},es={class:"mt-1"},ls={key:1},as={class:"mt-1"},ns={class:"card"},os={class:"card-header flex items-center justify-between"},is={class:"card-body"},ds={key:0,class:"text-center text-gray-500 py-8"},rs={key:1,class:"space-y-3"},us={class:"font-medium"},ms={class:"text-sm text-gray-500"},ps={class:"card"},vs={class:"card-header flex items-center justify-between"},cs={class:"btn btn-sm btn-primary cursor-pointer"},bs={class:"card-body"},gs={key:0,class:"text-center text-gray-500 py-8"},ys={key:1,class:"grid grid-cols-3 gap-4"},fs=["src"],xs={class:"space-y-6"},_s={class:"card"},ws={class:"card-body space-y-3"},hs={class:"card"},ks={class:"card-body space-y-3"},Cs={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},$s={class:"bg-white rounded-xl p-6 w-full max-w-md"},Vs={class:"grid grid-cols-3 gap-3"},Ds={class:"flex gap-3"},Us={__name:"SiteVisitDetails",setup(Ms){const q=L(),e=V(null),v=V(!1),d=S({room_name:"",length:null,width:null,height:null,notes:""}),c=async()=>{const{data:i}=await b.get(`/site-visits/${q.params.id}`);e.value=i.data},g=async i=>{await b.put(`/site-visits/${e.value.id}`,{status:i}),c()},U=async()=>{await b.post(`/site-visits/${e.value.id}/measurements`,d),v.value=!1,Object.assign(d,{room_name:"",length:null,width:null,height:null,notes:""}),c()},F=async i=>{const t=new FormData;for(const y of i.target.files)t.append("photos[]",y);await b.post(`/site-visits/${e.value.id}/photos`,t,{headers:{"Content-Type":"multipart/form-data"}}),c()},N=i=>E(i).format("YYYY/MM/DD HH:mm"),f=i=>({scheduled:"مجدولة",in_progress:"جارية",completed:"مكتملة",cancelled:"ملغاة"})[i]||i,x=i=>({scheduled:"badge-info",in_progress:"badge-warning",completed:"badge-success",cancelled:"badge-danger"})[i]||"badge-gray";return T(c),(i,t)=>{var _,w,h,k,C,$;const y=z("router-link");return e.value?(o(),a("div",O,[s("div",P,[s("div",null,[s("h2",R,"معاينة - "+n((_=e.value.lead)==null?void 0:_.name),1),s("p",A,n(N(e.value.scheduled_at)),1)]),s("span",{class:D([x(e.value.status),"badge text-base px-4 py-2"])},n(f(e.value.status)),3)]),s("div",G,[s("div",I,[s("div",J,[t[21]||(t[21]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"تفاصيل المعاينة")],-1)),s("div",K,[s("div",Q,[s("div",null,[t[10]||(t[10]=s("span",{class:"text-gray-500"},"العميل:",-1)),t[11]||(t[11]=u()),s("span",W,n((w=e.value.lead)==null?void 0:w.name),1)]),s("div",null,[t[12]||(t[12]=s("span",{class:"text-gray-500"},"الهاتف:",-1)),t[13]||(t[13]=u()),s("span",X,n((h=e.value.lead)==null?void 0:h.phone),1)]),s("div",null,[t[14]||(t[14]=s("span",{class:"text-gray-500"},"المهندس:",-1)),t[15]||(t[15]=u()),s("span",Z,n((k=e.value.engineer)==null?void 0:k.name),1)]),s("div",null,[t[16]||(t[16]=s("span",{class:"text-gray-500"},"الحالة:",-1)),t[17]||(t[17]=u()),s("span",{class:D([x(e.value.status),"badge mr-2"])},n(f(e.value.status)),3)])]),s("div",null,[t[18]||(t[18]=s("span",{class:"text-gray-500 text-sm"},"العنوان:",-1)),s("p",ss,n(e.value.address),1)]),e.value.client_requirements?(o(),a("div",ts,[t[19]||(t[19]=s("span",{class:"text-gray-500 text-sm"},"متطلبات العميل:",-1)),s("p",es,n(e.value.client_requirements),1)])):r("",!0),e.value.notes?(o(),a("div",ls,[t[20]||(t[20]=s("span",{class:"text-gray-500 text-sm"},"ملاحظات:",-1)),s("p",as,n(e.value.notes),1)])):r("",!0)])]),s("div",ns,[s("div",os,[t[22]||(t[22]=s("h3",{class:"font-semibold"},"القياسات",-1)),s("button",{onClick:t[0]||(t[0]=l=>v.value=!0),class:"btn btn-sm btn-primary"},"إضافة قياس")]),s("div",is,[((C=e.value.measurements)==null?void 0:C.length)===0?(o(),a("div",ds,"لا توجد قياسات")):(o(),a("div",rs,[(o(!0),a(M,null,j(e.value.measurements,l=>(o(),a("div",{key:l.id,class:"p-3 bg-gray-50 rounded-lg"},[s("p",us,n(l.room_name),1),s("p",ms,n(l.length)+"م × "+n(l.width)+"م × "+n(l.height)+"م = "+n(l.area)+" م²",1)]))),128))]))])]),s("div",ps,[s("div",vs,[t[24]||(t[24]=s("h3",{class:"font-semibold"},"الصور",-1)),s("label",cs,[t[23]||(t[23]=u(" رفع صور ",-1)),s("input",{type:"file",multiple:"",accept:"image/*",onChange:F,class:"hidden"},null,32)])]),s("div",bs,[(($=e.value.photos)==null?void 0:$.length)===0?(o(),a("div",gs,"لا توجد صور")):(o(),a("div",ys,[(o(!0),a(M,null,j(e.value.photos,l=>(o(),a("img",{key:l.id,src:`/storage/${l.photo_path}`,class:"rounded-lg object-cover h-32 w-full"},null,8,fs))),128))]))])])]),s("div",xs,[s("div",_s,[t[25]||(t[25]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"تغيير الحالة")],-1)),s("div",ws,[e.value.status==="scheduled"?(o(),a("button",{key:0,onClick:t[1]||(t[1]=l=>g("in_progress")),class:"btn btn-primary w-full"},"بدء المعاينة")):r("",!0),e.value.status==="in_progress"?(o(),a("button",{key:1,onClick:t[2]||(t[2]=l=>g("completed")),class:"btn btn-success w-full"},"إكمال المعاينة")):r("",!0),e.value.status!=="cancelled"&&e.value.status!=="completed"?(o(),a("button",{key:2,onClick:t[3]||(t[3]=l=>g("cancelled")),class:"btn btn-danger w-full"},"إلغاء")):r("",!0)])]),s("div",hs,[t[27]||(t[27]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"إجراءات")],-1)),s("div",ks,[Y(y,{to:`/quotations/create?lead_id=${e.value.lead_id}&site_visit_id=${e.value.id}`,class:"btn btn-secondary w-full"},{default:B(()=>[...t[26]||(t[26]=[u("إنشاء عرض سعر",-1)])]),_:1},8,["to"])])])])]),v.value?(o(),a("div",Cs,[s("div",$s,[t[34]||(t[34]=s("h3",{class:"text-lg font-semibold mb-4"},"إضافة قياس",-1)),s("form",{onSubmit:H(U,["prevent"]),class:"space-y-4"},[s("div",null,[t[28]||(t[28]=s("label",{class:"form-label"},"اسم الغرفة",-1)),m(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>d.room_name=l),class:"form-input",required:""},null,512),[[p,d.room_name]])]),s("div",Vs,[s("div",null,[t[29]||(t[29]=s("label",{class:"form-label"},"الطول (م)",-1)),m(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>d.length=l),type:"number",step:"0.01",class:"form-input"},null,512),[[p,d.length]])]),s("div",null,[t[30]||(t[30]=s("label",{class:"form-label"},"العرض (م)",-1)),m(s("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>d.width=l),type:"number",step:"0.01",class:"form-input"},null,512),[[p,d.width]])]),s("div",null,[t[31]||(t[31]=s("label",{class:"form-label"},"الارتفاع (م)",-1)),m(s("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>d.height=l),type:"number",step:"0.01",class:"form-input"},null,512),[[p,d.height]])])]),s("div",null,[t[32]||(t[32]=s("label",{class:"form-label"},"ملاحظات",-1)),m(s("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>d.notes=l),class:"form-input",rows:"2"},null,512),[[p,d.notes]])]),s("div",Ds,[t[33]||(t[33]=s("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),s("button",{type:"button",onClick:t[9]||(t[9]=l=>v.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):r("",!0)])):r("",!0)}}};export{Us as default};
