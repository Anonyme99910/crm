import{a as _,r as V,n as K,c as n,d as x,b as s,t as l,x as U,A as D,F as w,p as h,s as u,e as c,y as M,i as P,k as S,l as Q,w as Y,v as b,B as W,q as p,h as X,o as d}from"./app-Cs6lHxPq.js";import{d as F}from"./dayjs.min-CxMP4GVf.js";const Z={key:0,class:"space-y-6"},ss={class:"flex items-center justify-between"},ts={class:"text-sm text-gray-500"},es={class:"text-2xl font-bold"},os={class:"text-gray-500"},as={class:"card"},ls={class:"card-body"},ns={class:"flex items-center justify-between mb-2"},ds={class:"text-2xl font-bold text-primary-600"},is={class:"w-full bg-gray-200 rounded-full h-4"},rs={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},us={class:"lg:col-span-2 space-y-6"},cs={class:"card"},ps={class:"card-header flex items-center justify-between"},ms={class:"card-body space-y-4"},vs={class:"flex items-center justify-between mb-2"},bs={class:"font-medium"},gs={class:"flex items-center gap-4 mb-2"},fs={class:"flex-1"},ys={class:"w-full bg-gray-200 rounded-full h-2"},_s={class:"text-sm font-medium"},xs={class:"flex items-center gap-4"},ws=["onUpdate:modelValue","onChange"],hs=["onUpdate:modelValue","onChange"],js={class:"card"},ks={class:"card-header flex items-center justify-between"},Cs={class:"btn btn-sm btn-primary cursor-pointer"},$s={class:"card-body"},Vs={key:0,class:"text-center text-gray-500 py-8"},Us={key:1,class:"grid grid-cols-4 gap-4"},Ds=["src"],Ms={class:"absolute bottom-1 right-1 badge badge-gray text-xs"},Ps={class:"card"},Ss={class:"card-header flex items-center justify-between"},Ys={class:"card-body space-y-4"},Fs={class:"flex items-center justify-between mb-2"},Ns={class:"font-medium"},Ts={class:"text-xs text-gray-500"},qs={class:"text-sm text-gray-600"},zs={class:"text-xs text-gray-400 mt-2"},Bs={class:"space-y-6"},Ls={class:"card"},Es={class:"card-body space-y-3 text-sm"},Gs={class:"mr-2"},Hs={class:"mr-2 font-medium"},Os={class:"mr-2"},As={class:"mr-2"},Is={class:"mr-2"},Rs={class:"card"},Js={class:"card-body"},Ks={class:"card"},Qs={class:"card-body space-y-2"},Ws={key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Xs={class:"bg-white rounded-xl p-6 w-full max-w-md"},Zs={class:"flex gap-3"},st={key:1,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},tt={class:"bg-white rounded-xl p-6 w-full max-w-md"},et={class:"flex items-center gap-2"},ot={class:"flex gap-3"},dt={__name:"ProjectDetails",setup(at){const N=X(),o=_(null),g=_(!1),f=_(!1),m=V({name:"",budget:0}),i=V({title:"",content:"",visible_to_client:!1}),v=async()=>{const{data:a}=await p.get(`/projects/${N.params.id}`);o.value=a.data},T=async()=>{await p.put(`/projects/${o.value.id}`,{status:o.value.status})},q=async a=>{await p.put(`/projects/${o.value.id}/phases/${a.id}`,{progress_percentage:a.progress_percentage}),v()},z=async a=>{await p.put(`/projects/${o.value.id}/phases/${a.id}`,{status:a.status})},B=async()=>{await p.post(`/projects/${o.value.id}/phases`,m),g.value=!1,Object.assign(m,{name:"",budget:0}),v()},L=async()=>{await p.post(`/projects/${o.value.id}/updates`,i),f.value=!1,Object.assign(i,{title:"",content:"",visible_to_client:!1}),v()},E=async a=>{const t=new FormData;for(const y of a.target.files)t.append("photos[]",y);t.append("type","during"),await p.post(`/projects/${o.value.id}/photos`,t,{headers:{"Content-Type":"multipart/form-data"}}),v()},j=a=>F(a).format("YYYY/MM/DD"),G=a=>F(a).format("YYYY/MM/DD HH:mm"),H=a=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(a),O=a=>({pending:"قيد الانتظار",in_progress:"جاري التنفيذ",on_hold:"متوقف",completed:"مكتمل"})[a]||a,A=a=>({pending:"badge-gray",in_progress:"badge-info",on_hold:"badge-warning",completed:"badge-success"})[a]||"badge-gray",I=a=>({pending:"قيد الانتظار",in_progress:"جاري",completed:"مكتمل"})[a]||a,R=a=>({pending:"badge-gray",in_progress:"badge-info",completed:"badge-success"})[a]||"badge-gray",J=a=>({before:"قبل",during:"أثناء",after:"بعد"})[a]||a;return K(v),(a,t)=>{var k,C,$;const y=Q("router-link");return o.value?(d(),n("div",Z,[s("div",ss,[s("div",null,[s("p",ts,l(o.value.project_number),1),s("h2",es,l(o.value.name),1),s("p",os,l((k=o.value.lead)==null?void 0:k.name),1)]),s("span",{class:U([A(o.value.status),"badge text-base px-4 py-2"])},l(O(o.value.status)),3)]),s("div",as,[s("div",ls,[s("div",ns,[t[10]||(t[10]=s("span",{class:"font-medium"},"نسبة الإنجاز الكلية",-1)),s("span",ds,l(o.value.progress_percentage)+"%",1)]),s("div",is,[s("div",{class:"bg-primary-600 h-4 rounded-full transition-all",style:D({width:o.value.progress_percentage+"%"})},null,4)])])]),s("div",rs,[s("div",us,[s("div",cs,[s("div",ps,[t[11]||(t[11]=s("h3",{class:"font-semibold"},"مراحل المشروع",-1)),s("button",{onClick:t[0]||(t[0]=e=>g.value=!0),class:"btn btn-sm btn-primary"},"إضافة مرحلة")]),s("div",ms,[(d(!0),n(w,null,h(o.value.phases,e=>(d(),n("div",{key:e.id,class:"p-4 bg-gray-50 rounded-lg"},[s("div",vs,[s("h4",bs,l(e.name),1),s("span",{class:U([R(e.status),"badge"])},l(I(e.status)),3)]),s("div",gs,[s("div",fs,[s("div",ys,[s("div",{class:"bg-green-500 h-2 rounded-full",style:D({width:e.progress_percentage+"%"})},null,4)])]),s("span",_s,l(e.progress_percentage)+"%",1)]),s("div",xs,[c(s("input",{type:"range","onUpdate:modelValue":r=>e.progress_percentage=r,min:"0",max:"100",class:"flex-1",onChange:r=>q(e)},null,40,ws),[[b,e.progress_percentage]]),c(s("select",{"onUpdate:modelValue":r=>e.status=r,class:"form-input w-32 text-sm",onChange:r=>z(e)},[...t[12]||(t[12]=[s("option",{value:"pending"},"قيد الانتظار",-1),s("option",{value:"in_progress"},"جاري",-1),s("option",{value:"completed"},"مكتمل",-1)])],40,hs),[[M,e.status]])])]))),128))])]),s("div",js,[s("div",ks,[t[14]||(t[14]=s("h3",{class:"font-semibold"},"صور المشروع",-1)),s("label",Cs,[t[13]||(t[13]=u(" رفع صور ",-1)),s("input",{type:"file",multiple:"",accept:"image/*",onChange:E,class:"hidden"},null,32)])]),s("div",$s,[((C=o.value.photos)==null?void 0:C.length)===0?(d(),n("div",Vs,"لا توجد صور")):(d(),n("div",Us,[(d(!0),n(w,null,h(o.value.photos,e=>(d(),n("div",{key:e.id,class:"relative group"},[s("img",{src:`/storage/${e.photo_path}`,class:"rounded-lg object-cover h-24 w-full"},null,8,Ds),s("span",Ms,l(J(e.type)),1)]))),128))]))])]),s("div",Ps,[s("div",Ss,[t[15]||(t[15]=s("h3",{class:"font-semibold"},"تحديثات المشروع",-1)),s("button",{onClick:t[1]||(t[1]=e=>f.value=!0),class:"btn btn-sm btn-primary"},"إضافة تحديث")]),s("div",Ys,[(d(!0),n(w,null,h(o.value.updates,e=>{var r;return d(),n("div",{key:e.id,class:"p-4 bg-gray-50 rounded-lg"},[s("div",Fs,[s("h4",Ns,l(e.title),1),s("span",Ts,l(G(e.created_at)),1)]),s("p",qs,l(e.content),1),s("p",zs,l((r=e.user)==null?void 0:r.name),1)])}),128))])])]),s("div",Bs,[s("div",Ls,[t[26]||(t[26]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"معلومات المشروع")],-1)),s("div",Es,[s("div",null,[t[16]||(t[16]=s("span",{class:"text-gray-500"},"مدير المشروع:",-1)),t[17]||(t[17]=u()),s("span",Gs,l(($=o.value.manager)==null?void 0:$.name),1)]),s("div",null,[t[18]||(t[18]=s("span",{class:"text-gray-500"},"قيمة العقد:",-1)),t[19]||(t[19]=u()),s("span",Hs,l(H(o.value.contract_value)),1)]),s("div",null,[t[20]||(t[20]=s("span",{class:"text-gray-500"},"تاريخ البدء:",-1)),t[21]||(t[21]=u()),s("span",Os,l(j(o.value.start_date)),1)]),s("div",null,[t[22]||(t[22]=s("span",{class:"text-gray-500"},"تاريخ الانتهاء:",-1)),t[23]||(t[23]=u()),s("span",As,l(j(o.value.expected_end_date)),1)]),s("div",null,[t[24]||(t[24]=s("span",{class:"text-gray-500"},"العنوان:",-1)),t[25]||(t[25]=u()),s("span",Is,l(o.value.address),1)])])]),s("div",Rs,[t[28]||(t[28]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"تغيير الحالة")],-1)),s("div",Js,[c(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.value.status=e),onChange:T,class:"form-input"},[...t[27]||(t[27]=[s("option",{value:"pending"},"قيد الانتظار",-1),s("option",{value:"in_progress"},"جاري التنفيذ",-1),s("option",{value:"on_hold"},"متوقف",-1),s("option",{value:"completed"},"مكتمل",-1)])],544),[[M,o.value.status]])])]),s("div",Ks,[t[31]||(t[31]=s("div",{class:"card-header"},[s("h3",{class:"font-semibold"},"روابط سريعة")],-1)),s("div",Qs,[P(y,{to:`/tasks?project_id=${o.value.id}`,class:"btn btn-secondary w-full"},{default:S(()=>[...t[29]||(t[29]=[u("المهام",-1)])]),_:1},8,["to"]),P(y,{to:`/invoices?project_id=${o.value.id}`,class:"btn btn-secondary w-full"},{default:S(()=>[...t[30]||(t[30]=[u("الفواتير",-1)])]),_:1},8,["to"])])])])]),g.value?(d(),n("div",Ws,[s("div",Xs,[t[35]||(t[35]=s("h3",{class:"text-lg font-semibold mb-4"},"إضافة مرحلة",-1)),s("form",{onSubmit:Y(B,["prevent"]),class:"space-y-4"},[s("div",null,[t[32]||(t[32]=s("label",{class:"form-label"},"اسم المرحلة",-1)),c(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>m.name=e),class:"form-input",required:""},null,512),[[b,m.name]])]),s("div",null,[t[33]||(t[33]=s("label",{class:"form-label"},"الميزانية",-1)),c(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>m.budget=e),type:"number",class:"form-input",min:"0"},null,512),[[b,m.budget]])]),s("div",Zs,[t[34]||(t[34]=s("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),s("button",{type:"button",onClick:t[5]||(t[5]=e=>g.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):x("",!0),f.value?(d(),n("div",st,[s("div",tt,[t[40]||(t[40]=s("h3",{class:"text-lg font-semibold mb-4"},"إضافة تحديث",-1)),s("form",{onSubmit:Y(L,["prevent"]),class:"space-y-4"},[s("div",null,[t[36]||(t[36]=s("label",{class:"form-label"},"العنوان",-1)),c(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.title=e),class:"form-input",required:""},null,512),[[b,i.title]])]),s("div",null,[t[37]||(t[37]=s("label",{class:"form-label"},"المحتوى",-1)),c(s("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.content=e),class:"form-input",rows:"3",required:""},null,512),[[b,i.content]])]),s("div",et,[c(s("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>i.visible_to_client=e),id:"visible",class:"rounded"},null,512),[[W,i.visible_to_client]]),t[38]||(t[38]=s("label",{for:"visible",class:"text-sm"},"مرئي للعميل",-1))]),s("div",ot,[t[39]||(t[39]=s("button",{type:"submit",class:"btn btn-primary"},"حفظ",-1)),s("button",{type:"button",onClick:t[9]||(t[9]=e=>f.value=!1),class:"btn btn-secondary"},"إلغاء")])],32)])])):x("",!0)])):x("",!0)}}};export{dt as default};
