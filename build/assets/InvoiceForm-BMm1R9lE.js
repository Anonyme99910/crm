import{a as q,r as D,h as I,g as b,n as F,c as r,b as t,w as N,e as o,y as S,F as g,p as j,v as a,t as u,i as B,k as E,l as G,q as V,f as P,o as d,s as R}from"./app-Cs6lHxPq.js";import{d as w}from"./dayjs.min-CxMP4GVf.js";const T={class:"max-w-3xl"},A={class:"card"},L={class:"grid grid-cols-2 gap-6"},$=["value"],z=["onUpdate:modelValue"],H=["onUpdate:modelValue"],J=["onUpdate:modelValue"],K=["onClick"],O={class:"flex justify-end"},Q={class:"w-64 space-y-2 text-sm"},W={class:"flex justify-between"},X={class:"flex justify-between"},Z={class:"flex justify-between font-bold text-lg border-t pt-2"},h={class:"flex gap-4"},tt=["disabled"],nt={__name:"InvoiceForm",setup(et){const p=I(),U=P(),c=q(!1),y=q([]),l=D({project_id:p.query.project_id?parseInt(p.query.project_id):null,contract_id:p.query.contract_id?parseInt(p.query.contract_id):null,title:"",issue_date:w().format("YYYY-MM-DD"),due_date:w().add(30,"day").format("YYYY-MM-DD"),tax_rate:14,items:[{description:"",quantity:1,unit_price:0}]}),m=b(()=>l.items.reduce((n,e)=>n+e.quantity*e.unit_price,0)),_=b(()=>m.value*(l.tax_rate/100)),k=b(()=>m.value+_.value),M=()=>l.items.push({description:"",quantity:1,unit_price:0}),f=n=>new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(n||0),Y=async()=>{const{data:n}=await V.get("/projects");y.value=n.data},C=async()=>{var n,e;c.value=!0;try{await V.post("/invoices",l),U.push("/invoices")}catch(v){alert(((e=(n=v.response)==null?void 0:n.data)==null?void 0:e.message)||"حدث خطأ")}finally{c.value=!1}};return F(Y),(n,e)=>{const v=G("router-link");return d(),r("div",T,[t("div",A,[e[16]||(e[16]=t("div",{class:"card-header"},[t("h3",{class:"font-semibold"},"إنشاء فاتورة")],-1)),t("form",{onSubmit:N(C,["prevent"]),class:"card-body space-y-6"},[t("div",L,[t("div",null,[e[6]||(e[6]=t("label",{class:"form-label"},"المشروع *",-1)),o(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>l.project_id=s),class:"form-input",required:""},[e[5]||(e[5]=t("option",{value:null},"-- اختر --",-1)),(d(!0),r(g,null,j(y.value,s=>(d(),r("option",{key:s.id,value:s.id},u(s.name),9,$))),128))],512),[[S,l.project_id]])]),t("div",null,[e[7]||(e[7]=t("label",{class:"form-label"},"العنوان *",-1)),o(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.title=s),class:"form-input",required:""},null,512),[[a,l.title]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"form-label"},"تاريخ الإصدار *",-1)),o(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>l.issue_date=s),type:"date",class:"form-input",required:""},null,512),[[a,l.issue_date]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"form-label"},"تاريخ الاستحقاق *",-1)),o(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>l.due_date=s),type:"date",class:"form-input",required:""},null,512),[[a,l.due_date]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"form-label"},"نسبة الضريبة %",-1)),o(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>l.tax_rate=s),type:"number",class:"form-input",min:"0",max:"100"},null,512),[[a,l.tax_rate]])])]),t("div",null,[t("div",{class:"flex items-center justify-between mb-2"},[e[11]||(e[11]=t("label",{class:"form-label"},"البنود",-1)),t("button",{type:"button",onClick:M,class:"text-sm text-primary-600"},"+ إضافة")]),(d(!0),r(g,null,j(l.items,(s,x)=>(d(),r("div",{key:x,class:"grid grid-cols-12 gap-2 mb-2"},[o(t("input",{"onUpdate:modelValue":i=>s.description=i,class:"form-input col-span-6",placeholder:"الوصف",required:""},null,8,z),[[a,s.description]]),o(t("input",{"onUpdate:modelValue":i=>s.quantity=i,type:"number",class:"form-input col-span-2",placeholder:"الكمية",min:"1",required:""},null,8,H),[[a,s.quantity]]),o(t("input",{"onUpdate:modelValue":i=>s.unit_price=i,type:"number",class:"form-input col-span-3",placeholder:"السعر",min:"0",required:""},null,8,J),[[a,s.unit_price]]),t("button",{type:"button",onClick:i=>l.items.splice(x,1),class:"text-red-600 col-span-1"},"×",8,K)]))),128))]),t("div",O,[t("div",Q,[t("div",W,[e[12]||(e[12]=t("span",null,"الإجمالي الفرعي:",-1)),t("span",null,u(f(m.value)),1)]),t("div",X,[e[13]||(e[13]=t("span",null,"الضريبة:",-1)),t("span",null,u(f(_.value)),1)]),t("div",Z,[e[14]||(e[14]=t("span",null,"الإجمالي:",-1)),t("span",null,u(f(k.value)),1)])])]),t("div",h,[t("button",{type:"submit",disabled:c.value,class:"btn btn-primary"},u(c.value?"جاري الحفظ...":"حفظ"),9,tt),B(v,{to:"/invoices",class:"btn btn-secondary"},{default:E(()=>[...e[15]||(e[15]=[R("إلغاء",-1)])]),_:1})])],32)])])}}};export{nt as default};
